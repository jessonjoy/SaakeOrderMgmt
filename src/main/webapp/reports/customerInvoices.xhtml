<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template/template.xhtml">        
        <ui:define name="title">
            <h:outputText value="Customer Invoices Report"></h:outputText>
        </ui:define>
        <ui:define name="content">
            <h:form>
                <ui:include src="/template/messages.xhtml"/>
                                
                <p:dataTable id="invoiceListTable" value="#{invoiceCtrl.model}" var="invoice" rowKey="#{invoice.invoiceId}"
                             styleClass="invoiceList invoiceItemClass font16" selection="#{invoiceCtrl.current}" selectionMode="single"
                             paginator="true" rows="10" paginatorAlwaysVisible="true" paginatorPosition="bottom" 
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                             rowsPerPageTemplate="5,10,15" filteredValue="#{invoiceCtrl.invoiceList}" widgetVar="invoiceTable"  >  
                    <!--                    <f:facet name="header">  
                                            <p:outputPanel>  
                                                <h:outputText value="Search all fields:" />  
                                                <p:inputText id="globalFilter" onkeyup="invoiceTable.filter()" style="width:150px" />  
                                            </p:outputPanel>  
                                        </f:facet>-->
                    <p:column sortBy="#{invoice.invoiceId}" headerText="ID" filterBy="invoiceId">                              
                        <h:outputText value="#{invoice.invoiceId}"/>
                    </p:column>
                    <p:column sortBy="#{invoice.invoiceNum}" headerText="Invoice #" filterBy="invoiceNum">                              
                        <h:outputText value="#{invoice.invoiceNum}"/>
                    </p:column>
                    <p:column sortBy="#{item.invoiceDate}" headerText="Date" filterBy="invoiceDate">                              
                        <h:outputText value="#{invoice.invoiceDate}">
                            <f:convertDateTime type="date" pattern="dd-MM-YYY"/>
                        </h:outputText>
                    </p:column>                    
                    <p:column sortBy="#{invoice.customerId.firstName}" headerText="Customer" filterBy="firstName">                              
                        <h:outputText value="#{invoice.customerId.firstName} #{invoice.customerId.firstName}"/>
                    </p:column>
                    <p:column sortBy="#{invoice.amount}" headerText="Amount" filterBy="amount">                              
                        <h:outputText value="#{invoice.amount}">
                            <f:convertNumber type="currency" currencySymbol=" " />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Status" rendered="false">                              
                        <h:outputText value=""/>
                    </p:column>
                    <p:column  width="5%">
                        <f:facet name="header">
                            <h:outputText value="&nbsp;"/>
                        </f:facet>
                        <h:commandLink action="#{invoiceCtrl.prepareView}" styleClass="editInvoice">
                            <h:graphicImage url="/resources/images/invoice.png" width="16" height="16" alt="View" styleClass="editInvoice"/>
                        </h:commandLink>                        
                    </p:column>
                    <p:column width="5%" style="float:middle">
                        <f:facet name="header">
                            <h:outputText value="&nbsp;"/>
                        </f:facet>

                        <h:commandLink action="#{invoiceCtrl.prepareEdit}" styleClass="editInvoice" >
                            <h:graphicImage url="/resources/images/edit-black-2.png" width="16" height="16" alt="Edit" styleClass="editInvoice"/>
                            <f:setPropertyActionListener target="#{invoiceCtrl.current}" value="#{invoice}"/>
                        </h:commandLink>                       
                    </p:column>
                    <p:column  width="5%">
                        <f:facet name="header">
                            <h:outputText value="&nbsp;"/>
                        </f:facet>

                        <p:commandLink action="#{invoiceCtrl.delete}" styleClass="editInvoice" onclick="window.confirm('Are you sure you want to delete this invoice?');"
                                       update="invoiceListTable">
                            <h:graphicImage url="/resources/images/black_delete.png" width="12" height="12" alt="Delete" styleClass="editInvoice"/>
                            <f:setPropertyActionListener target="#{invoiceCtrl.current}" value="#{invoice}"/>
                        </p:commandLink>  
                    </p:column>
                    <!--                    <f:facet name="footer">  
                                            Total #{fn:length(invoiceCtrl.invoiceList)} invoices.
                                        </f:facet>-->
                    <p:ajax event="rowDblselect" listener="#{invoiceCtrl.redirectToView(invoice.invoiceId)}">
                    </p:ajax>
                </p:dataTable>
                
                <p:contextMenu for="invoiceListTable">  
                    <p:menuitem value="View" action="#{invoiceCtrl.redirectToView(null)}" includeViewParams="true" 
                                style="background: url('../resources/images/invoice.png') no-repeat; background-size: 16px 16px; padding-left: 20px; "/>
                    <p:menuitem value="Edit" action="#{invoiceCtrl.prepareEdit}" includeViewParams="true" 
                                style="background: url('../resources/images/edit-black-2.png') no-repeat ;background-size: 16px 16px; padding-left: 20px; "/>
                </p:contextMenu> 
                
            </h:form>
        </ui:define>
    </ui:composition>
</html>
