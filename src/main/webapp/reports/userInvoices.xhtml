<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template/template.xhtml">
        <ui:define name="title">
            <h:outputText value="User WorkOrders"></h:outputText>
        </ui:define>
        <ui:define name="content">
            <h:form prependId="false">
                <ui:include src="/template/messages.xhtml"/>
                <h:panelGroup id="filterPG" layout="block" style="width:100%" >
                    <h:panelGrid width="100%" columns="2" columnClasses="noBorder label1 width20pr, noBorder width80pr" styleClass="borderRound10 viewInfo" >                           
                        <h:outputLabel value="User:" />
                        <p:autoComplete id="userSugg" value="#{workOrderCtrl.userInvoiceVO.user}" completeMethod="#{userCtrl.suggestUser}"  
                                        var="user"  dropdown="true" itemLabel="#{user.firstLastName}" itemValue="#{user}" size="20" 
                                        queryDelay="2">                                        
                            <p:column>  
                                <f:facet name="header">
                                    <h:outputText value="Name" styleClass="bold"/>
                                </f:facet>
                                <h:outputText value="#{user.firstLastName}"/> 
                            </p:column>              

                            <p:ajax event="itemSelect" listener="#{workOrderCtrl.filterUserInvoices}" update="userInvTable" />
                        </p:autoComplete>
                        <h:outputLabel value="Month:" />
                        <p:selectOneMenu value="#{workOrderCtrl.userInvoiceVO.month}">
                            <f:selectItems value="#{listCtrl.monthsSI}" ></f:selectItems>

                            <p:ajax event="change" listener="#{workOrderCtrl.filterUserInvoices}" update="userInvTable" />
                        </p:selectOneMenu>

                        <h:outputText value="Incentive Amount:" />
                        <p:outputPanel autoUpdate="true" styleClass="viewInfo" >
                        <h:outputText value="#{workOrderCtrl.userInvoiceVO.incentiveAmount}" />
                        </p:outputPanel>
                    </h:panelGrid>
                    <p:separator style="margin: 5px 0 5px 0" />

                    <p:dataTable id="userInvTable" value="#{workOrderCtrl.userInvoiceVO.woList}" var="inv" styleClass="invoiceList dataListStyle1 font16"
                                 rowIndexVar="rows" rowKey="#{rows}" widgetVar="userInvTable"  >                      
                        <p:column width="5%" >  
                            <f:facet name="header">
                                <h:outputText value="#"/>
                            </f:facet>
                            <h:outputText value="#{rows + 1}" />
                        </p:column>
                        <p:column sortBy="#{inv.assignedUser.firstLastName}" headerText="User" width="15%">
                            <f:facet name="header">
                                <h:outputText value="User"/>
                            </f:facet>
                            <h:outputText value="#{inv.assignedUser.firstLastName}"/>
                        </p:column>                       

                        <p:column headerText="Invoice #" width="10%" sortBy="#{inv.workOrderId}" >
                            <f:facet name="header">
                                <h:outputText value="WO #"/>
                            </f:facet>
                            <h:outputText value="#{inv.workOrderId}"/>                                                   
                        </p:column>                                               
                        <p:column headerText="Date" width="10%" sortBy="#{inv.workOrderDate}" >
                            <f:facet name="header">
                                <h:outputText value="Date"/>
                            </f:facet>
                            <h:outputText value="#{inv.workOrderDate}">
                                <f:convertDateTime type="date"/>
                            </h:outputText>
                        </p:column>                                               

                        <p:column headerText="Status" width="10%" sortBy="#{inv.status}" >
                            <f:facet name="header">
                                <h:outputText value="Status"/>
                            </f:facet>
                            <h:outputText value="#{inv.status}"/>                                                   
                        </p:column>                                               

                        <p:column headerText="Amount" width="10%" sortBy="#{inv.amount}" >
                            <f:facet name="header">
                                <h:outputText value="Amount"/>
                            </f:facet>
                            <h:outputText value="#{inv.amount}"/>                                                   
                        </p:column>                                               

                        <p:column headerText="Labor" width="10%" sortBy="#{inv.laborAmt}" >
                            <f:facet name="header">
                                <h:outputText value="Labor"/>
                            </f:facet>
                            <h:outputText value="#{inv.laborAmt}"/>                                                   
                        </p:column>                                               

                        <p:column headerText="Adj Labor" width="10%" sortBy="#{inv.laborAdjAmt}" >
                            <f:facet name="header">
                                <h:outputText value="Adj Labor"/>
                            </f:facet>
                            <h:outputText value="#{inv.laborAdjAmt}"/>                                                   
                        </p:column>                                               

                        <f:facet name="footer">  
                            <table class="" cellpadding="0" cellspacing="0" width="100%">
                                <tfoot >
                                    <tr >
                                        <td >
                                            <h:outputText value="Total #{fn:length(workOrderCtrl.userInvoiceVO.woList)} Invoices"/>
                                        </td>
                                        <td >
                                            <span></span>
                                        </td>
                                        <td >
                                            <span></span>
                                        </td>
                                        <td >
                                            <span></span>
                                        </td>

                                        <td style="">
                                            <h:outputText value="#{workOrderCtrl.userInvoiceVO.totInvoiceAmt}"/> 
                                        </td>
                                        <td style="text-align: right">
                                            <h:outputText value="#{workOrderCtrl.userInvoiceVO.totLaborAmt}"/>                                        
                                        </td>
                                        <td style="text-align: right;">
                                            <h:outputText value="#{workOrderCtrl.userInvoiceVO.totAdjLaborAmt}"/> 
                                        </td>
                                        <td >
                                            <span></span>
                                        </td>
                                    </tr>            
                                </tfoot>
                            </table>
                        </f:facet>
                    </p:dataTable>
                </h:panelGroup>
            </h:form>
        </ui:define>
    </ui:composition>
</html>
